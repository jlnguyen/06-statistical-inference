---
title: "Inference Course Project"
author: "Joe Nguyen"
date: "31 October 2015"
output: pdf_document
---

In this project, we use simulation to explore inference and do some simple inferential data analysis. The project consists of two parts:

- A simulation exercise
- Basic inferential data analysis


## A. Simulation for Distribution of Means of Exponentials

We investigate the exponential distribution and the Central Limit Theorem (CLT). The mean of the exponential distribution is $1 / \lambda$ and the standard deviation is also $1 / \lambda$. We set $\lambda = 0.2$ for all simulations. We investigate the distribution of averages of 40 exponentials using 1000 simulations.

### 1. Sample Mean

We show the sample mean (from simulations) and compare it with the theoretical mean of the distribution.

```{r, echo=FALSE}
set.seed(12345)

# Exponential distribution rate parameter
lambda <- 0.2
nSim <- 1000
n <- 40

# Distribution of averages of n (= 40) exponential distributions
datExpMn <- apply(matrix(rexp(nSim * n, lambda), nSim), 1, mean)

## Histogram, sample mean, theoretical mean
mnSample <- mean(datExpMn)
mnTheory <- 1/lambda

cat("Sample mean: ", mnSample, " vs. Theoretical mean: ", mnTheory, sep = "")
```

In Fig. 1 (in Appendix), the sample mean (red dashed line) is close to the theoretical mean (blue solid line).


### 2. Sample Variance

We compare the sample variance to the theoretical variance ($1 / \lambda ^2$) by reporting the mean sample variance and theoretical variance, and also plotting the sample variance distribution from the simulations in Fig. 2.

```{r, echo=FALSE}
datExpVar <- apply(matrix(rexp(nSim * n, lambda), nSim), 1, var)
varSample <- mean(datExpVar)
varTheory <- lambda ^ -2

cat("Sample variance: ", varSample, " vs. Theoretical variance: ", varTheory, sep = "")
```


### 3. Distribution of Mean of Multiple Draws from Exponential is Approximately Normal

Here, we compare the distribution of 1000 draws of the exponential distribution to the distribution of 1000 "averages of 40 draws from the exponential distribution".

Figure 3 highlights the CLT which states that in the limit as more samples are drawn, the average of these draws follows a Gaussian distribution. The consequence of the CLT is evident in Fig. 3 (right) where the histogram of averages of draws fits in the Gaussian density plot (red line). A beneficial result of the CLT is that in the limit, we can use the sample mean to approximate the mean of the underlying distribution; for the exponential, this is $\frac{1}{\lambda} = \frac{1}{0.2} = 5$ as seen in Fig. 3 (right).



## B. Inference on $ToothGrowth$ Data

Information about the dataset:

The response is the length of odontoblasts (teeth) in each of 10 guinea pigs at each of three dose levels of Vitamin C (0.5, 1, and 2 mg) with each of two delivery methods (orange juice or ascorbic acid).

### 1. Load the $ToothGrowth$ data

Explore the dataset.
```{r, echo=TRUE}
data("ToothGrowth")
str(ToothGrowth)
rbind(head(ToothGrowth,2), tail(ToothGrowth,2))
```

### 2. Provide a Basic Summary of the Data

```{r, echo=FALSE, fig.height=4, fig.width=8}
summary(ToothGrowth)

library(ggplot2)
tg <- ggplot(ToothGrowth, aes(x = dose, y = len), col = supp) + 
    geom_point(shape = 1, size = 3) + 
    facet_wrap(~ supp)
tg
```

Figure 3. Response (len) based on dose (0.5, 1, 2)mg and supplement type (OJ, VC) from 10 guinea pigs.

### 3. Compare Tooth Growth

Tooth growth (len) is compared by dose and supplement type (supp). T-tests are used to determine the difference between pairs of dose and the supp pair. We use t-tests because the response (len) appears to by roughly symmetric and mound shaped in Fig. 3.


#### i. Dose

First, differences in len are evaluate for pairs of dose levels = {0.5, 1, 2} mg. The data are paired by dose and so three paired t-test are performed:

| t-test Index | Dose A | Dose B |
| ------------ | ------ | ------ |
| 1 | 0.5 | 1 |
| 2 | 0.5 | 2 |
| 3 | 1 | 2 |

Also, group variances are assumed to be unequal as they are unknown. Assuming unequal variance results in wider confidence intervals than equal variance, which is more conservative. The 95% confidence intervals (CIs) are:

```{r, echo=FALSE}
lenDose1 <- subset(ToothGrowth, dose %in% c(0.5,1))
lenDose2 <- subset(ToothGrowth, dose %in% c(0.5,2))
lenDose3 <- subset(ToothGrowth, dose %in% c(1,2))

rbind(
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose1)$conf,
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose2)$conf,
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose3)$conf
)
```

As the 95% CIs are entired below zero, these t-tests suggest the smaller doses result in less tooth growth; or, increasing the dose increases tooth growth. Additionally, the p-values are small (<< 0.05), strongly suggesting more tooth growth with higher doses.

```{r, echo=FALSE}
rbind(
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose1)$p.value,
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose2)$p.value,
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose3)$p.value
)
```


#### ii. Supplement

Second, a paired t-test is performed to evaluate a difference in tooth growth (len) between the two supplments (supp = {OJ, VC}). Again, unequal variance is assumed to be conservative.

```{r, echo=TRUE}
t.test(len ~ supp, paired = TRUE, var.equal = FALSE, data = ToothGrowth)
```

The 95% CI = (1.409, 5.991) suggests the supplment OJ results in more tooth growth than supplment VC. This is corroborated by a small p-value = 0.00255.

\pagebreak

# Appendix

```{r, echo=FALSE, fig.height=4, fig.width=8}
hist(datExpMn, main = "Distribution of Mean of 40 Exponentials",
     xlab = "x"
)
abline(v = mnSample, lty = 1, lwd = 5, col = "blue")
abline(v = mnTheory, lty = 2, lwd = 5, col = "red")

legend("topright", legend = c("Sample Mean", "Theoretical Mean"), lty = c(1,2), lwd = 3, col = c("blue", "red"))
```

Figure 1. Distribution of mean of 40 exponentials using 1000 simulations.

```{r, echo=FALSE, fig.height=4, fig.width=8}
## Histogram, sample variance, theoretical variance
hist(datExpVar, main = "Distribution of Variance of 40 Exponentials",
     xlab = "x"
)
abline(v = varSample, lty = 1, lwd = 5, col = "blue")
abline(v = varTheory, lty = 2, lwd = 5, col = "red")

legend("topright", legend = c("Sample Var", "Theoretical Var"),
       lty = c(1,2), lwd = 3, col = c("blue", "red"))
```

Figure 2. Distribution of variance of 40 exponentials using 1000 simulations.

```{r, echo=TRUE, warning=FALSE, message=FALSE, fig.height=4, fig.width=8}
datSample <- data.frame(x = c(rexp(nSim), datExpMn),
                        group = factor(rep(c(1,2), each = nSim),
                        labels = c("Single Draw", "Average of 40 Draws"))
                        )
library(ggplot2)
g <- ggplot(datSample, aes(x)) + 
    geom_histogram() + 
    facet_wrap(~ group) + 
    ggtitle("Exponential Draws Distribution")

# Overlay Normal distribution
x <- mnSample + sd(datExpMn) * seq(-3, 3, length = 1000)
y <- dnorm(x, mnSample, sd(datExpMn))

# Scale density to count of datExpMn
y <- y * max(ggplot_build(g)$data[[1]]$count) / max(y)
datNorm <- data.frame(x = c(x, x),
                      y = c(rep(NaN, length(y)), y),
                      group = factor(rep(c(1,2), each = nSim),
                      labels = c("Single Draw", "Average of 40 Draws"))
                      )
# Plot
g + geom_line(aes(x,y), data = datNorm, col = "red") + facet_wrap(~ group)
```

Figure 3. Comparison between sampling distributions with single draws and average of 40 draws from an exponential distribution.


## Code for summary of $ToothGrowth$ data

```{r, eval=FALSE}
summary(ToothGrowth)

tg <- ggplot(ToothGrowth, aes(x = dose, y = len), col = supp) + 
    geom_point(shape = 1, size = 3) + 
    facet_wrap(~ supp)
tg
```


## Code for Dose CIs and P-values

```{r, eval=FALSE}
lenDose1 <- subset(ToothGrowth, dose %in% c(0.5,1))
lenDose2 <- subset(ToothGrowth, dose %in% c(0.5,2))
lenDose3 <- subset(ToothGrowth, dose %in% c(1,2))

rbind(
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose1)$conf,
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose2)$conf,
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose3)$conf
)

rbind(
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose1)$p.value,
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose2)$p.value,
    t.test(len ~ dose, paired = TRUE, var.equal = FALSE, data = lenDose3)$p.value
)
```
